<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Model Persistence Test</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
    .success { color: green; }
    .fail { color: red; }
    .info { color: blue; }
    button { padding: 10px; margin: 5px; }
  </style>
</head>
<body>
  <h1>Model Persistence Test</h1>

  <div class="test-section">
    <h2>Settings Service Test</h2>
    <button onclick="testNewUser()">Test New User (Should default to Hermes)</button>
    <button onclick="testExistingUser()">Test Existing User (Should restore saved)</button>
    <button onclick="clearSettings()">Clear Settings</button>
    <button onclick="showCurrentSettings()">Show Current Settings</button>
    <div id="results"></div>
  </div>

  <script type="module">
    import { SettingsService } from './src/lib/settings-service.js';

    const settingsService = new SettingsService();
    const resultsDiv = document.getElementById('results');

    window.testNewUser = () => {
      // Clear settings to simulate new user
      settingsService.clear();
      const newService = new SettingsService();
      const model = newService.getModel();

      resultsDiv.innerHTML = `
        <h3>New User Test:</h3>
        <p class="${model === 'Hermes-3-Llama-3.1-8B-q4f16_1-MLC' ? 'success' : 'fail'}">
          Default Model: ${model || 'null'}
          <br>Expected: Hermes-3-Llama-3.1-8B-q4f16_1-MLC
          <br>Status: ${model === 'Hermes-3-Llama-3.1-8B-q4f16_1-MLC' ? '✅ PASS' : '❌ FAIL'}
        </p>
      `;
    };

    window.testExistingUser = () => {
      // Save a different model
      settingsService.setModel('SmolLM2-135M-Instruct-q4f16_1-MLC');

      // Create new instance to simulate page reload
      const newService = new SettingsService();
      const model = newService.getModel();

      resultsDiv.innerHTML = `
        <h3>Existing User Test:</h3>
        <p class="${model === 'SmolLM2-135M-Instruct-q4f16_1-MLC' ? 'success' : 'fail'}">
          Restored Model: ${model}
          <br>Expected: SmolLM2-135M-Instruct-q4f16_1-MLC
          <br>Status: ${model === 'SmolLM2-135M-Instruct-q4f16_1-MLC' ? '✅ PASS' : '❌ FAIL'}
        </p>
      `;
    };

    window.clearSettings = () => {
      settingsService.clear();
      resultsDiv.innerHTML = '<p class="info">Settings cleared!</p>';
    };

    window.showCurrentSettings = () => {
      const settings = settingsService.settings;
      resultsDiv.innerHTML = `
        <h3>Current Settings:</h3>
        <pre>${JSON.stringify(settings, null, 2)}</pre>
      `;
    };
  </script>
</body>
</html>